{% extends 'base.html.twig' %}

{% block content %}
<div class="center-container">

<div class='active_filters'>
<span class='descr'>Active Filters</span>
<ul>
{% for filter in filters %}
 <li class='filtername'>{{ filter.filter }} {{ filter.choice }} "{{ filter.value }}"
 <span class='filtervalue'>
 {% if is_admin %}
 <a href="{{ route('ADMIN_SEARCH_FILTER_DEL', { filter_id: loop.index0 }) }}">Remove</a>
 {% else %}
 <a href="{{ route('SEARCH_FILTER_DEL', { filter_id: loop.index0 }) }}">Remove</a>
 {% endif %}
 </span></li>
{% else %}
<li>No filters</li>
{% endfor %}
</ul>
<span class='delall'>
{% if is_admin %}
<a href="{{ route('ADMIN_SEARCH_FILTER_DEL') }}">Remove all</a>
{% else %}
<a href="{{ route('SEARCH_FILTER_DEL') }}">Remove all</a>
{% endif %}
</span>
</div>

{% if searchform %}
<div class='searchform'>

<span class='descr'>Add Filters</span>

<div class='formsearch'>
{{ form_start(searchform) }}
<div class='search_errors'>
{{ form_errors(searchform) }}
</div>

<div class="form-line">
   {{ form_widget(searchform.filter) }}
</div>
<div class="form-line">
   {{ form_widget(searchform.choice) }}
</div>
<div class="form-line row-flex">
   {{ form_widget(searchform.value) }}
   {{ form_widget(searchform.search) }}
</div>
{{ form_end(searchform) }}
</div>

<span class="form-errors name">
{{ form_errors(searchform.value) }}
</span>

</div>
{% endif %}

{% if stats %}
<div class='statistics'>
<span class='descr'>Statistics</span>
<ul>
 <li><span class="left">Total Records:</span> {{ stats.count|nf }}</li>
 {% if stats.count > 0 %}
 <li><span class="left">Stored:</span> {{ stats.stored|nf }}</li>
 <li><span class="left">Notifications:</span> {{ stats.notified|nf }}</li>
 <li><span class="left">Released:</span> {{ stats.released|nf }}</li>
 <li><span class="left">Has Virus:</span> {{ stats.has_virus|nf }}</li>
 <hr>
 {# Loop through all actions dynamically #}
{% for action, count in stats.action %}
    <li>
        <span class="left">{{ action|capitalize }}
		  ({{ ((count / stats.count * 100)|round(2))|nf(1) }}%):</span>
        {{ count|nf }}
    </li>
{% endfor %}
 <hr>
 <li><span class="left">Oldest Record:</span> {{ stats.first }}</li>
 <li><span class="left">Newest Record:</span> {{ stats.last }}</li>
 {% endif %}
</ul>
</div>
{% endif %}

<div class='reports'>
<span class='descr'>Results and Reports</span>
<ul>
{% if stats.count > 0 %}
 {% if is_admin %}
 <li><a href='{{ route('ADMIN_SEARCH_RESULTS') }}'>Search Results</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'date', mode: 'day' }) }}'>Mails per day</a>
 (<a href='{{ route('ADMIN_REPORTS', { field: 'date', mode: 'count' }) }}'>by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'date', mode: 'volume' }) }}'>by Volume</a>)
 </li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'ip'}) }}'>Top IPs by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'ip', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mail_from'}) }}'>Top Mail From by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mail_from', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mime_from'}) }}'>Top MIME From by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mime_from', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'rcpt_to'}) }}'>Top RCPT To by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'rcpt_to', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mime_to'}) }}'>Top MIME To by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mime_to', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mail_from_domain'}) }}'>Top Mail From Domains by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mail_from_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mime_from_domain'}) }}'>Top MIME From Domains by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mime_from_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'rcpt_to_domain'}) }}'>Top RCPT To Domains by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'rcpt_to_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'mime_to_domain'}) }}'>Top MIME To Domains by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'mime_to_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('ADMIN_REPORTS', { field: 'server'}) }}'>Top Servers by Quantity</a>
 / <a href='{{ route('ADMIN_REPORTS', { field: 'server', mode: 'volume'}) }}'>Volume</a></li>
 {% else %}
 <li><a href='{{ route('SEARCH_RESULTS') }}'>Search Results</a></li>
 <li><a href='{{ route('REPORTS', { field: 'date', mode: 'day' }) }}'>Mails per day</a>
 (<a href='{{ route('REPORTS', { field: 'date', mode: 'count' }) }}'>by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'date', mode: 'volume' }) }}'>by Volume</a>)
 </li>
 <li><a href='{{ route('REPORTS', { field: 'ip'}) }}'>Top IPs by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'ip', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mail_from'}) }}'>Top Mail From by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mail_from', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mime_from'}) }}'>Top MIME From by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mime_from', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'rcpt_to'}) }}'>Top RCPT To by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'rcpt_to', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mime_to'}) }}'>Top MIME To by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mime_to', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mail_from_domain'}) }}'>Top Mail From Domains by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mail_from_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mime_from_domain'}) }}'>Top MIME From Domains by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mime_from_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'rcpt_to_domain'}) }}'>Top RCPT To Domains by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'rcpt_to_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'mime_to_domain'}) }}'>Top MIME To Domains by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'mime_to_domain', mode: 'volume'}) }}'>Volume</a></li>
 <li><a href='{{ route('REPORTS', { field: 'server'}) }}'>Top Servers by Quantity</a>
 / <a href='{{ route('REPORTS', { field: 'server', mode: 'volume'}) }}'>Volume</a></li>
 {% endif %}
{% else %}
No results found
{% endif %}
</ul>

</div>

{% if is_admin and redis_config_ttl is not null %}
  {% if redis_config_ttl > 0 %}
    <p class='help-text2'>
      Config expires from Redis in {{ redis_config_ttl }}
      [{{ redis_config_expires_at }}]
    </p>
  {% elseif redis_config_ttl == -1 %}
    <p class='help-text2'>Redis config has no expiration (persistent)</p>
  {% elseif redis_config_ttl == -2 %}
    <p class='help-text2'>Redis config key not found</p>
  {% endif %}

  <p class='help-text2'><a href='{{ route('CONFIG_RELOAD') }}'>Reload Config</a></p>
{% endif %}

</div>

{% endblock %}
